from __future__ import print_function
import sys, os, shutil
from argparse import ArgumentParser

sys.path.append("@simfempythonpath@")
sys.path.append("@libpythonpath@")

import mesh.geometry
import tools.plot
import tools.testerrors
import numpy as np
import simfempy
import simfemcdr
import time

#---------------------------------------------------------#
def main():
    meshtypes = ["LineMesh"]
    testname = "poisson"
    testname = "cdrexp"
    testname = "rdcosh"
    hmeans=[0.5*0.5**i for i in range(10)]
    # hmeans=[0.5*0.5**i for i in range(4)]
    methods=["traditionalintegration", "nitscheintegration", "newnitscheintegration","traditional", "nitsche", "newnitsche"]
    # methods=["traditionalintegration", "nitscheintegration", "newnitscheintegration"]
    # methods=["traditionalintegration"]
    methods=["traditional", "nitsche", "newnitsche", "nitscheintegration", "newnitscheintegration"]
    methods=["newnitscheintegration", "nitscheintegration", "traditionalintegration"]
    paramdict = {}
    paramdict["fem"] = "P1"
    for meshtype in meshtypes:
        test(meshtype, testname, methods, hmeans, paramdict)


#---------------------------------------------------------#
def test(meshtype, testname, methods, hmeans, paramdict):
    if  meshtype == "LineMesh":
        from mesh.geometries.unitline import GeometryClass
    elif  meshtype == "TriangleMesh":
        from mesh.geometries.unitsquare import GeometryClass
    elif  meshtype == "TetrahedralMesh":
        from mesh.geometries.unitcube import GeometryClass

    if testname == "cdrexp":
        paramdict["diff"] = 0.001
        paramdict["beta"] = "east"
        paramdict["alpha"] = 0.0
        paramdict["application"]="cdexplayer"
    elif testname == "rdcosh":
        paramdict["diff"] = 0.0001
        paramdict["beta"] = "zero"
        paramdict["alpha"] = 1.0
        paramdict["application"]="rdcosh"
    elif testname == "poisson":
        paramdict["diff"] = 1.0
        paramdict["beta"] = "zero"
        paramdict["alpha"] = 0.0
        paramdict["application"]="quadratic"
        # application="cosinus"
        # application="linear"
    solver = simfemcdr.Solver()
    testtype = 'hmean'
    if testtype == 'hmean':
        hmean = None
        params=hmeans
    elif testtype == 'robin':
        hmean=0.02
        params=[0.001* 5.0**i for i in range(15)]
    simfemplot = tools.plot.SimFemPlot(methods, params=hmeans, param='hmean')
    simfemplot.methodsnames["traditionalintegration"] = "trad"
    simfemplot.methodsnames["nitscheintegration"] = "nit"
    simfemplot.methodsnames["newnitscheintegration"] = "new"
    simfemplot.paramname = "h"
    simfemplot.order = False
    simfemplot.filename = testname+'.png'
    errs = ["L1"]
    simfemtesterrors = tools.testerrors.SimFemTestErrors(solver=solver, errs=errs, plotter=simfemplot, meshtype=meshtype, paramdict=paramdict, methods=methods, param=testtype, params=params, hmean=hmean)
    simfemtesterrors.run()


#---------------------------------------------------------#
if __name__ == '__main__':
    main()
